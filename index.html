<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reading Journal</title>
  <script src="https://cdn.jsdelivr.net/npm/marked@15/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3/dist/purify.min.js"></script>
  <style>
    /* â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:        #0d1117;
      --surface:   #161b22;
      --surface2:  #1f2937;
      --border:    #30363d;
      --accent:    #58a6ff;
      --accent2:   #3fb950;
      --danger:    #f85149;
      --text:      #e6edf3;
      --muted:     #8b949e;
      --glow:      0 0 12px rgba(88,166,255,.45);
      --radius:    10px;
      --font:      'Segoe UI', system-ui, -apple-system, sans-serif;
      --mono:      'JetBrains Mono', 'Fira Code', 'Cascadia Code', monospace;
    }

    html { scroll-behavior: smooth; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font);
      min-height: 100vh;
      line-height: 1.6;
    }

    /* â”€â”€ Scrollbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--muted); }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(13,17,23,.85);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 0 24px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.15rem;
      font-weight: 700;
      letter-spacing: .5px;
      color: var(--accent);
      text-shadow: var(--glow);
    }

    .logo svg { flex-shrink: 0; }

    .header-actions { display: flex; gap: 8px; }

    /* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 7px 16px;
      border-radius: 6px;
      font-size: .875rem;
      font-weight: 600;
      cursor: pointer;
      border: 1px solid transparent;
      transition: all .18s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--accent);
      color: #000;
      border-color: var(--accent);
    }
    .btn-primary:hover { background: #79c0ff; border-color: #79c0ff; box-shadow: var(--glow); }

    .btn-ghost {
      background: transparent;
      color: var(--text);
      border-color: var(--border);
    }
    .btn-ghost:hover { background: var(--surface2); border-color: var(--accent); color: var(--accent); }

    .btn-danger {
      background: transparent;
      color: var(--danger);
      border-color: var(--danger);
    }
    .btn-danger:hover { background: rgba(248,81,73,.12); }

    .btn-success {
      background: var(--accent2);
      color: #000;
      border-color: var(--accent2);
    }
    .btn-success:hover { background: #56d364; border-color: #56d364; box-shadow: 0 0 12px rgba(63,185,80,.45); }

    .btn-sm { padding: 4px 10px; font-size: .8rem; }

    /* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .container { max-width: 1100px; margin: 0 auto; padding: 32px 24px; }

    .page { display: none; }
    .page.active { display: block; }

    /* â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hero {
      text-align: center;
      padding: 64px 0 48px;
      position: relative;
    }

    .hero::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse 70% 50% at 50% 0%, rgba(88,166,255,.08) 0%, transparent 70%);
      pointer-events: none;
    }

    .hero h1 {
      font-size: clamp(2rem, 5vw, 3.2rem);
      font-weight: 800;
      background: linear-gradient(135deg, #58a6ff 0%, #3fb950 50%, #d2a8ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 12px;
    }

    .hero p {
      color: var(--muted);
      font-size: 1.1rem;
      margin-bottom: 32px;
    }

    /* â”€â”€ Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .books-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    /* â”€â”€ Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      cursor: pointer;
      transition: all .2s ease;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--accent), #d2a8ff);
      opacity: 0;
      transition: opacity .2s;
    }

    .card:hover {
      border-color: var(--accent);
      transform: translateY(-3px);
      box-shadow: 0 8px 32px rgba(88,166,255,.15);
    }

    .card:hover::before { opacity: 1; }

    .card-title {
      font-size: 1.05rem;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text);
    }

    .card-meta {
      font-size: .8rem;
      color: var(--muted);
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: rgba(88,166,255,.12);
      color: var(--accent);
      border: 1px solid rgba(88,166,255,.25);
      border-radius: 20px;
      padding: 2px 8px;
      font-size: .75rem;
    }

    .badge-green {
      background: rgba(63,185,80,.12);
      color: var(--accent2);
      border-color: rgba(63,185,80,.25);
    }

    /* â”€â”€ Add Book Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card-add {
      border-style: dashed;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 120px;
      color: var(--muted);
      gap: 8px;
      font-size: .95rem;
      transition: all .2s ease;
    }

    .card-add:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(88,166,255,.04);
      transform: none;
      box-shadow: none;
    }

    .card-add::before { display: none; }

    /* â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.6);
      backdrop-filter: blur(4px);
      z-index: 200;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s;
    }

    .modal-overlay.open {
      opacity: 1;
      pointer-events: all;
    }

    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      width: 100%;
      max-width: 520px;
      padding: 28px;
      transform: translateY(16px);
      transition: transform .2s;
    }

    .modal-overlay.open .modal { transform: translateY(0); }

    .modal h2 {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--accent);
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 24px;
    }

    /* â”€â”€ Form elements â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .form-group { margin-bottom: 16px; }

    label {
      display: block;
      font-size: .875rem;
      font-weight: 600;
      color: var(--muted);
      margin-bottom: 6px;
    }

    input[type="text"], textarea {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      font-family: inherit;
      font-size: .95rem;
      padding: 9px 12px;
      outline: none;
      transition: border-color .15s;
    }

    input[type="text"]:focus, textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(88,166,255,.15);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    /* â”€â”€ Book Detail Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--muted);
      font-size: .875rem;
      cursor: pointer;
      border: none;
      background: none;
      padding: 0;
      margin-bottom: 24px;
      transition: color .15s;
    }
    .back-btn:hover { color: var(--accent); }

    .book-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 32px;
      flex-wrap: wrap;
    }

    .book-title {
      font-size: clamp(1.4rem, 3vw, 2rem);
      font-weight: 800;
      color: var(--text);
      position: relative;
    }

    .book-title::after {
      content: '';
      display: block;
      height: 3px;
      width: 60%;
      background: linear-gradient(90deg, var(--accent), transparent);
      margin-top: 8px;
      border-radius: 2px;
    }

    .book-actions { display: flex; gap: 8px; flex-shrink: 0; }

    /* â”€â”€ Progress bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .progress-wrap {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px 20px;
      margin-bottom: 28px;
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      font-size: .8rem;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .progress-bar-bg {
      height: 6px;
      background: var(--border);
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      border-radius: 3px;
      transition: width .4s cubic-bezier(.4,0,.2,1);
      box-shadow: 0 0 8px rgba(88,166,255,.5);
    }

    /* â”€â”€ Chapter list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chapters-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .chapters-header h3 {
      font-size: 1rem;
      font-weight: 700;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .chapter-item {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 12px;
      overflow: hidden;
      transition: border-color .2s;
    }

    .chapter-item:hover { border-color: rgba(88,166,255,.4); }

    .chapter-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 18px;
      cursor: pointer;
      user-select: none;
    }

    .chapter-number {
      font-size: .75rem;
      font-family: var(--mono);
      background: rgba(88,166,255,.12);
      color: var(--accent);
      border: 1px solid rgba(88,166,255,.25);
      border-radius: 4px;
      padding: 2px 8px;
      flex-shrink: 0;
    }

    .chapter-name {
      font-weight: 600;
      flex: 1;
      color: var(--text);
    }

    .chapter-status {
      font-size: .75rem;
      flex-shrink: 0;
    }

    .chapter-toggle {
      color: var(--muted);
      transition: transform .2s;
      flex-shrink: 0;
    }

    .chapter-item.open .chapter-toggle { transform: rotate(90deg); }

    .chapter-body {
      display: none;
      border-top: 1px solid var(--border);
      padding: 0;
    }

    .chapter-item.open .chapter-body { display: block; }

    /* â”€â”€ Markdown Editor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .editor-wrap {
      display: flex;
      flex-direction: column;
    }

    .editor-tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      padding: 0 16px;
      gap: 0;
    }

    .editor-tab {
      padding: 10px 16px;
      font-size: .85rem;
      font-weight: 600;
      color: var(--muted);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all .15s;
      margin-bottom: -1px;
    }

    .editor-tab.active {
      color: var(--text);
      border-bottom-color: var(--accent);
    }

    .editor-tab:hover:not(.active) { color: var(--text); }

    .editor-toolbar {
      display: flex;
      gap: 4px;
      padding: 8px 16px;
      border-bottom: 1px solid var(--border);
      flex-wrap: wrap;
    }

    .toolbar-btn {
      background: none;
      border: 1px solid transparent;
      border-radius: 4px;
      color: var(--muted);
      cursor: pointer;
      font-size: .8rem;
      font-family: var(--mono);
      font-weight: 700;
      padding: 3px 8px;
      transition: all .15s;
    }

    .toolbar-btn:hover {
      background: var(--surface2);
      border-color: var(--border);
      color: var(--text);
    }

    .editor-pane {
      padding: 16px;
    }

    .editor-pane textarea {
      min-height: 200px;
      font-family: var(--mono);
      font-size: .875rem;
      line-height: 1.7;
    }

    .preview-pane {
      display: none;
      padding: 16px 20px;
      min-height: 200px;
    }

    .chapter-body[data-mode="preview"] .editor-pane { display: none; }
    .chapter-body[data-mode="preview"] .preview-pane { display: block; }
    .chapter-body[data-mode="preview"] .editor-toolbar { display: none; }

    /* â”€â”€ Markdown Preview Styles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .markdown-preview {
      color: var(--text);
      line-height: 1.75;
      font-size: .9375rem;
    }

    .markdown-preview h1,
    .markdown-preview h2,
    .markdown-preview h3,
    .markdown-preview h4 {
      margin: 1.25em 0 .5em;
      font-weight: 700;
      color: var(--text);
    }

    .markdown-preview h1 { font-size: 1.5em; border-bottom: 1px solid var(--border); padding-bottom: .3em; }
    .markdown-preview h2 { font-size: 1.25em; border-bottom: 1px solid var(--border); padding-bottom: .3em; }
    .markdown-preview h3 { font-size: 1.1em; }

    .markdown-preview p { margin: .75em 0; }

    .markdown-preview code {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 4px;
      font-family: var(--mono);
      font-size: .85em;
      padding: 2px 6px;
      color: #e96900;
    }

    .markdown-preview pre {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 14px 16px;
      overflow-x: auto;
      margin: 1em 0;
    }

    .markdown-preview pre code {
      background: none;
      border: none;
      padding: 0;
      color: var(--text);
      font-size: .875em;
    }

    .markdown-preview blockquote {
      border-left: 3px solid var(--accent);
      padding-left: 16px;
      margin: 1em 0;
      color: var(--muted);
    }

    .markdown-preview ul, .markdown-preview ol {
      padding-left: 1.5em;
      margin: .75em 0;
    }

    .markdown-preview li { margin: .3em 0; }

    .markdown-preview a { color: var(--accent); text-decoration: underline; }

    .markdown-preview hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 1.5em 0;
    }

    .markdown-preview table {
      width: 100%;
      border-collapse: collapse;
      margin: 1em 0;
      font-size: .9em;
    }

    .markdown-preview th, .markdown-preview td {
      border: 1px solid var(--border);
      padding: 8px 12px;
      text-align: left;
    }

    .markdown-preview th {
      background: var(--surface2);
      font-weight: 700;
    }

    .markdown-preview tr:nth-child(even) td { background: rgba(255,255,255,.02); }

    .markdown-preview img { max-width: 100%; border-radius: 6px; }

    /* â”€â”€ Chapter footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chapter-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 16px;
      border-top: 1px solid var(--border);
      gap: 8px;
      flex-wrap: wrap;
    }

    .chapter-footer-left { display: flex; align-items: center; gap: 8px; }

    .read-checkbox {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: .85rem;
      color: var(--muted);
      cursor: pointer;
      user-select: none;
    }

    .read-checkbox input { cursor: pointer; accent-color: var(--accent2); width: 15px; height: 15px; }

    /* â”€â”€ Empty state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }

    .empty-state svg { opacity: .3; margin-bottom: 16px; }
    .empty-state p { font-size: 1rem; margin-bottom: 4px; }
    .empty-state span { font-size: .875rem; opacity: .7; }

    /* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--surface2);
      border: 1px solid var(--accent2);
      color: var(--text);
      border-radius: 8px;
      padding: 12px 20px;
      font-size: .875rem;
      font-weight: 600;
      box-shadow: 0 4px 20px rgba(0,0,0,.4);
      z-index: 500;
      opacity: 0;
      transform: translateY(8px);
      transition: all .25s ease;
      pointer-events: none;
    }

    #toast.show { opacity: 1; transform: translateY(0); }

    /* â”€â”€ Scan line animation (subtle) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @keyframes scanline {
      0%  { background-position: 0 0; }
      100%{ background-position: 0 100vh; }
    }

    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background: repeating-linear-gradient(
        0deg,
        rgba(255,255,255,.015) 0px,
        rgba(255,255,255,.015) 1px,
        transparent 1px,
        transparent 4px
      );
      pointer-events: none;
      z-index: 999;
    }

    /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 600px) {
      .container { padding: 20px 16px; }
      header { padding: 0 16px; }
      .hero { padding: 36px 0 28px; }
      .modal { padding: 20px; }
    }
  </style>
</head>
<body>

<!-- Header -->
<header>
  <div class="logo">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
      <rect x="3" y="3" width="18" height="18" rx="3" stroke="#58a6ff" stroke-width="1.5"/>
      <line x1="7" y1="8" x2="17" y2="8" stroke="#58a6ff" stroke-width="1.5" stroke-linecap="round"/>
      <line x1="7" y1="12" x2="17" y2="12" stroke="#58a6ff" stroke-width="1.5" stroke-linecap="round"/>
      <line x1="7" y1="16" x2="13" y2="16" stroke="#58a6ff" stroke-width="1.5" stroke-linecap="round"/>
    </svg>
    Reading Journal
  </div>
  <div class="header-actions">
    <button class="btn btn-primary" id="headerAddBtn" onclick="openAddBookModal()">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
      </svg>
      æœ¬ã‚’è¿½åŠ 
    </button>
  </div>
</header>

<!-- â”€â”€ Page: Book List â”€â”€ -->
<div class="page active" id="page-list">
  <div class="container">
    <div class="hero">
      <h1>ğŸ“š Reading Journal</h1>
      <p>æœ¬ã”ã¨ãƒ»ç« ã”ã¨ã«èª­æ›¸ãƒ¡ãƒ¢ã‚’ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã§è¨˜éŒ²ã—ã‚ˆã†</p>
    </div>
    <div class="books-grid" id="booksGrid"></div>
  </div>
</div>

<!-- â”€â”€ Page: Book Detail â”€â”€ -->
<div class="page" id="page-detail">
  <div class="container">
    <button class="back-btn" onclick="showList()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <polyline points="15 18 9 12 15 6"/>
      </svg>
      æœ¬ã®ä¸€è¦§ã«æˆ»ã‚‹
    </button>

    <div class="book-header">
      <div>
        <div class="book-title" id="detailTitle"></div>
        <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap" id="detailBadges"></div>
      </div>
      <div class="book-actions">
        <button class="btn btn-ghost btn-sm" onclick="openAddChapterModal()">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
          </svg>
          ç« ã‚’è¿½åŠ 
        </button>
        <button class="btn btn-danger btn-sm" onclick="deleteCurrentBook()">å‰Šé™¤</button>
      </div>
    </div>

    <div class="progress-wrap" id="progressWrap">
      <div class="progress-label">
        <span>èª­äº†é€²æ—</span>
        <span id="progressText">0 / 0 ç« </span>
      </div>
      <div class="progress-bar-bg">
        <div class="progress-bar-fill" id="progressFill" style="width:0%"></div>
      </div>
    </div>

    <div class="chapters-header">
      <h3>ç« ä¸€è¦§</h3>
    </div>
    <div id="chaptersList"></div>
  </div>
</div>

<!-- â”€â”€ Modal: Add Book â”€â”€ -->
<div class="modal-overlay" id="addBookModal">
  <div class="modal" role="dialog" aria-modal="true">
    <h2>ğŸ“– æœ¬ã‚’è¿½åŠ </h2>
    <div class="form-group">
      <label for="bookTitleInput">ã‚¿ã‚¤ãƒˆãƒ« <span style="color:var(--danger)">*</span></label>
      <input type="text" id="bookTitleInput" placeholder="ä¾‹: Clean Code" />
    </div>
    <div class="form-group">
      <label for="bookAuthorInput">è‘—è€…</label>
      <input type="text" id="bookAuthorInput" placeholder="ä¾‹: Robert C. Martin" />
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('addBookModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-primary" onclick="addBook()">è¿½åŠ ã™ã‚‹</button>
    </div>
  </div>
</div>

<!-- â”€â”€ Modal: Add Chapter â”€â”€ -->
<div class="modal-overlay" id="addChapterModal">
  <div class="modal" role="dialog" aria-modal="true">
    <h2>ğŸ“‘ ç« ã‚’è¿½åŠ </h2>
    <div class="form-group">
      <label for="chapterNameInput">ç« ã®ã‚¿ã‚¤ãƒˆãƒ« <span style="color:var(--danger)">*</span></label>
      <input type="text" id="chapterNameInput" placeholder="ä¾‹: ç¬¬1ç«  ã‚¯ãƒªãƒ¼ãƒ³ã‚³ãƒ¼ãƒ‰" />
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('addChapterModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-primary" onclick="addChapter()">è¿½åŠ ã™ã‚‹</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div id="toast"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   State
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let data = { books: [] };
let currentBookId = null;

const STORAGE_KEY = 'reading_journal_v2';

function load() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) data = JSON.parse(raw);
  } catch(e) { /* ignore */ }
}

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function uid() {
  if (typeof crypto !== 'undefined' && crypto.randomUUID) {
    return crypto.randomUUID();
  }
  return Date.now().toString(36) + Math.random().toString(36).slice(2, 7);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Toast
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let toastTimer;
function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove('show'), 2500);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Navigation
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showList() {
  document.getElementById('page-list').classList.add('active');
  document.getElementById('page-detail').classList.remove('active');
  document.getElementById('headerAddBtn').style.display = '';
  currentBookId = null;
  renderBooks();
}

function showDetail(bookId) {
  currentBookId = bookId;
  document.getElementById('page-list').classList.remove('active');
  document.getElementById('page-detail').classList.add('active');
  document.getElementById('headerAddBtn').style.display = 'none';
  renderDetail();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Book List
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderBooks() {
  const grid = document.getElementById('booksGrid');
  grid.innerHTML = '';

  if (data.books.length === 0) {
    grid.innerHTML = `
      <div class="empty-state" style="grid-column:1/-1">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><rect x="3" y="3" width="18" height="18" rx="3"/><line x1="7" y1="8" x2="17" y2="8"/><line x1="7" y1="12" x2="17" y2="12"/><line x1="7" y1="16" x2="13" y2="16"/></svg>
        <p>ã¾ã æœ¬ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
        <span>ã€Œæœ¬ã‚’è¿½åŠ ã€ã‹ã‚‰æœ€åˆã®1å†Šã‚’ç™»éŒ²ã—ã‚ˆã†</span>
      </div>`;
  }

  data.books.forEach(book => {
    const total = book.chapters.length;
    const done  = book.chapters.filter(c => c.done).length;
    const pct   = total > 0 ? Math.round(done / total * 100) : 0;

    const card = document.createElement('div');
    card.className = 'card';
    card.onclick = () => showDetail(book.id);
    card.innerHTML = `
      <div class="card-title">${escHtml(book.title)}</div>
      ${book.author ? `<div style="font-size:.8rem;color:var(--muted);margin-bottom:10px">${escHtml(book.author)}</div>` : ''}
      <div class="card-meta">
        <span class="badge">${total} ç« </span>
        ${done > 0 ? `<span class="badge badge-green">âœ“ ${done} èª­äº†</span>` : ''}
        ${total > 0 ? `<span style="color:var(--muted)">${pct}%</span>` : ''}
      </div>
      ${total > 0 ? `
        <div style="margin-top:12px">
          <div class="progress-bar-bg">
            <div class="progress-bar-fill" style="width:${pct}%"></div>
          </div>
        </div>` : ''}
    `;
    grid.appendChild(card);
  });

  // Add card
  const addCard = document.createElement('div');
  addCard.className = 'card card-add';
  addCard.onclick = openAddBookModal;
  addCard.innerHTML = `
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
      <circle cx="12" cy="12" r="9"/>
      <line x1="12" y1="8" x2="12" y2="16"/>
      <line x1="8" y1="12" x2="16" y2="12"/>
    </svg>
    æœ¬ã‚’è¿½åŠ 
  `;
  grid.appendChild(addCard);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Book Detail
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderDetail() {
  const book = data.books.find(b => b.id === currentBookId);
  if (!book) { showList(); return; }

  document.getElementById('detailTitle').textContent = book.title;

  // Badges
  const badges = document.getElementById('detailBadges');
  badges.innerHTML = '';
  if (book.author) {
    const b = document.createElement('span');
    b.className = 'badge';
    b.textContent = 'âœï¸ ' + book.author;
    badges.appendChild(b);
  }

  // Progress
  const total = book.chapters.length;
  const done  = book.chapters.filter(c => c.done).length;
  const pct   = total > 0 ? Math.round(done / total * 100) : 0;
  document.getElementById('progressText').textContent = `${done} / ${total} ç« `;
  document.getElementById('progressFill').style.width  = pct + '%';

  // Chapters
  const list = document.getElementById('chaptersList');
  list.innerHTML = '';

  if (total === 0) {
    list.innerHTML = `
      <div class="empty-state">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        <p>ç« ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</p>
        <span>ã€Œç« ã‚’è¿½åŠ ã€ã‹ã‚‰è¨˜éŒ²ã‚’å§‹ã‚ã‚ˆã†</span>
      </div>`;
    return;
  }

  book.chapters.forEach((ch, idx) => {
    const item = document.createElement('div');
    item.className = 'chapter-item';
    item.id = `ch-${ch.id}`;

    const statusBadge = ch.done
      ? `<span class="badge badge-green">âœ“ èª­äº†</span>`
      : `<span class="badge" style="opacity:.6">æœªèª­äº†</span>`;

    item.innerHTML = `
      <div class="chapter-header" onclick="toggleChapter('${ch.id}')">
        <span class="chapter-number">Ch.${idx + 1}</span>
        <span class="chapter-name">${escHtml(ch.name)}</span>
        <span class="chapter-status">${statusBadge}</span>
        <svg class="chapter-toggle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
      </div>
      <div class="chapter-body" data-mode="write">
        <div class="editor-tabs">
          <div class="editor-tab active" onclick="switchTab(event,'${ch.id}','write')">âœï¸ æ›¸ã</div>
          <div class="editor-tab" onclick="switchTab(event,'${ch.id}','preview')">ğŸ‘ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
        </div>
        <div class="editor-toolbar">
          <button class="toolbar-btn" title="Bold" onclick="insertMd('${ch.id}','**','**','å¤ªå­—')"><b>B</b></button>
          <button class="toolbar-btn" title="Italic" onclick="insertMd('${ch.id}','*','*','æ–œä½“')"><i>I</i></button>
          <button class="toolbar-btn" title="Code" onclick="insertMd('${ch.id}','` + '`' + `','` + '`' + `','ã‚³ãƒ¼ãƒ‰')">&#96;&#96;</button>
          <button class="toolbar-btn" title="Quote" onclick="insertMdLine('${ch.id}','> ')">â</button>
          <button class="toolbar-btn" title="H2" onclick="insertMdLine('${ch.id}','## ')">H2</button>
          <button class="toolbar-btn" title="H3" onclick="insertMdLine('${ch.id}','### ')">H3</button>
          <button class="toolbar-btn" title="List" onclick="insertMdLine('${ch.id}','- ')">â€¢ â€•</button>
          <button class="toolbar-btn" title="HR" onclick="insertMdLine('${ch.id}','---')">â€•â€•</button>
        </div>
        <div class="editor-pane">
          <textarea
            id="ta-${ch.id}"
            placeholder="ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã§ãƒ¡ãƒ¢ã‚’æ›¸ã“ã†â€¦&#10;&#10;ä¾‹ï¼š&#10;## æ°—ã¥ã&#10;- ãƒã‚¤ãƒ³ãƒˆ1&#10;- ãƒã‚¤ãƒ³ãƒˆ2&#10;&#10;> å°è±¡ã«æ®‹ã£ãŸä¸€æ–‡"
            oninput="onNoteInput('${ch.id}', this.value)"
          >${escHtml(ch.note || '')}</textarea>
        </div>
        <div class="preview-pane markdown-preview" id="pv-${ch.id}"></div>
        <div class="chapter-footer">
          <label class="read-checkbox">
            <input type="checkbox" ${ch.done ? 'checked' : ''} onchange="toggleDone('${ch.id}', this.checked)" />
            èª­äº†ãƒãƒ¼ã‚¯
          </label>
          <div style="display:flex;gap:6px">
            <button class="btn btn-danger btn-sm" onclick="deleteChapter('${ch.id}')">å‰Šé™¤</button>
          </div>
        </div>
      </div>
    `;

    list.appendChild(item);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Chapter interactions
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleChapter(chId) {
  const el = document.getElementById(`ch-${chId}`);
  el.classList.toggle('open');
}

function switchTab(e, chId, mode) {
  const body = document.querySelector(`#ch-${chId} .chapter-body`);
  const tabs  = body.parentElement.querySelectorAll('.editor-tab');
  tabs.forEach(t => t.classList.remove('active'));
  e.target.classList.add('active');

  body.dataset.mode = mode;

  if (mode === 'preview') {
    const note = document.getElementById(`ta-${chId}`).value;
    const pv = document.getElementById(`pv-${chId}`);
    pv.innerHTML = note.trim()
      ? DOMPurify.sanitize(marked.parse(note, { breaks: true, gfm: true }))
      : '<span style="color:var(--muted);font-style:italic">ã¾ã ä½•ã‚‚æ›¸ã„ã¦ã„ã¾ã›ã‚“</span>';
  }
}

function onNoteInput(chId, value) {
  const book = data.books.find(b => b.id === currentBookId);
  if (!book) return;
  const ch = book.chapters.find(c => c.id === chId);
  if (ch) {
    ch.note = value;
    ch.updatedAt = Date.now();
    save();
  }
}

function toggleDone(chId, checked) {
  const book = data.books.find(b => b.id === currentBookId);
  if (!book) return;
  const ch = book.chapters.find(c => c.id === chId);
  if (ch) {
    ch.done = checked;
    save();
    // Update progress bar & status badge without full re-render
    const total = book.chapters.length;
    const done  = book.chapters.filter(c => c.done).length;
    const pct   = total > 0 ? Math.round(done / total * 100) : 0;
    document.getElementById('progressText').textContent = `${done} / ${total} ç« `;
    document.getElementById('progressFill').style.width = pct + '%';

    const statusEl = document.querySelector(`#ch-${chId} .chapter-status`);
    if (statusEl) {
      statusEl.innerHTML = checked
        ? `<span class="badge badge-green">âœ“ èª­äº†</span>`
        : `<span class="badge" style="opacity:.6">æœªèª­äº†</span>`;
    }

    // Also update list page cards
    toast(checked ? 'âœ“ èª­äº†ãƒãƒ¼ã‚¯ã‚’ä»˜ã‘ã¾ã—ãŸï¼' : 'èª­äº†ãƒãƒ¼ã‚¯ã‚’å¤–ã—ã¾ã—ãŸ');
  }
}

function insertMd(chId, before, after, placeholder) {
  const ta = document.getElementById(`ta-${chId}`);
  const start = ta.selectionStart, end = ta.selectionEnd;
  const sel   = ta.value.substring(start, end) || placeholder;
  const newVal = ta.value.substring(0, start) + before + sel + after + ta.value.substring(end);
  ta.value = newVal;
  ta.focus();
  ta.setSelectionRange(start + before.length, start + before.length + sel.length);
  onNoteInput(chId, newVal);
}

function insertMdLine(chId, prefix) {
  const ta = document.getElementById(`ta-${chId}`);
  const start = ta.selectionStart;
  const lineStart = ta.value.lastIndexOf('\n', start - 1) + 1;
  const newVal = ta.value.substring(0, lineStart) + prefix + ta.value.substring(lineStart);
  ta.value = newVal;
  ta.focus();
  const pos = start + prefix.length;
  ta.setSelectionRange(pos, pos);
  onNoteInput(chId, newVal);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Add / Delete Book
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openAddBookModal() {
  document.getElementById('bookTitleInput').value = '';
  document.getElementById('bookAuthorInput').value = '';
  openModal('addBookModal');
  setTimeout(() => document.getElementById('bookTitleInput').focus(), 80);
}

function addBook() {
  const title  = document.getElementById('bookTitleInput').value.trim();
  const author = document.getElementById('bookAuthorInput').value.trim();
  if (!title) { shake('bookTitleInput'); return; }

  const book = { id: uid(), title, author, chapters: [], createdAt: Date.now() };
  data.books.unshift(book);
  save();
  closeModal('addBookModal');
  renderBooks();
  toast('ğŸ“– æœ¬ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼');
}

function deleteCurrentBook() {
  const book = data.books.find(b => b.id === currentBookId);
  if (!book) return;
  if (!confirm(`ã€Œ${book.title}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;
  data.books = data.books.filter(b => b.id !== currentBookId);
  save();
  showList();
  toast('æœ¬ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Add / Delete Chapter
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openAddChapterModal() {
  document.getElementById('chapterNameInput').value = '';
  openModal('addChapterModal');
  setTimeout(() => document.getElementById('chapterNameInput').focus(), 80);
}

function addChapter() {
  const name = document.getElementById('chapterNameInput').value.trim();
  if (!name) { shake('chapterNameInput'); return; }

  const book = data.books.find(b => b.id === currentBookId);
  if (!book) return;

  const ch = { id: uid(), name, note: '', done: false, createdAt: Date.now() };
  book.chapters.push(ch);
  save();
  closeModal('addChapterModal');
  renderDetail();
  toast('ğŸ“‘ ç« ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼');

  // Auto-open the new chapter
  requestAnimationFrame(() => {
    const el = document.getElementById(`ch-${ch.id}`);
    if (el) { el.classList.add('open'); el.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
  });
}

function deleteChapter(chId) {
  const book = data.books.find(b => b.id === currentBookId);
  if (!book) return;
  const ch = book.chapters.find(c => c.id === chId);
  if (!ch) return;
  if (!confirm(`ã€Œ${ch.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;
  book.chapters = book.chapters.filter(c => c.id !== chId);
  save();
  renderDetail();
  toast('ç« ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Modal helpers
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openModal(id) {
  document.getElementById(id).classList.add('open');
}

function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}

// Close on overlay click
document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', e => {
    if (e.target === overlay) overlay.classList.remove('open');
  });
});

// Close on Escape
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    document.querySelectorAll('.modal-overlay.open').forEach(m => m.classList.remove('open'));
  }
  // Ctrl/Cmd+Enter to add
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
    if (document.getElementById('addBookModal').classList.contains('open')) addBook();
    if (document.getElementById('addChapterModal').classList.contains('open')) addChapter();
  }
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Utilities
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function escHtml(str) {
  return String(str)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
}

function shake(inputId) {
  const el = document.getElementById(inputId);
  el.style.borderColor = 'var(--danger)';
  el.focus();
  setTimeout(() => el.style.borderColor = '', 1500);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Boot
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
load();
renderBooks();
</script>
</body>
</html>
